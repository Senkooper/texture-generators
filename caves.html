<html>
    <canvas>

    </canvas>
</html>
<script>
    const canvas = document.querySelector('canvas')
    draw = canvas.getContext('2d')

    canvas.width = window.innerWidth
    canvas.height = window.innerHeight
    
    draw.strokeStyle = "#808080"
    render()

    console.log(Math.round(canvas.height/200))
    console.log(Math.round(canvas.width/200))
    caveMap = genCavesStruct(10,30,100)
    drawCaveMap(caveMap,20,1)
  //  y = 1
    //console.log((y-1)*theMap.width)
   // console.log(caveMap)
 //   draw.fillStyle = "#0000FF"
   // draw.fillRect(0,0,canvas.width,canvas.height)
 //   console.log(theMap.width/20)
    //drawChunk()

  

    


    function getPixel(x = 0,y = 0,img){
        console.log(img)
        if (x < 0){
            x = 0
        }else{
            if (x > img.width){
                x = img.width
            }
        }
        if (y < 0){
            y = 0
        }else{
            if (y > img.height){
                y = img.height
            }
        }
       
        x = x*4
        y = (y*img.width*4)
        

        return [img.data[y+x],img.data[y+x+1],img.data[y+x+2],img.data[y+x+3]]
    }

   
    document.onresize = () => {
        render()
    }

    function render(){
        draw.fillRect(0,0,canvas.width,canvas.height)
        //draw.fillStyle = "#ff7f50"
        //draw.fillRect(0,0,200,200)

    }


    function drawCaveMap(caveDat,maxScale,minScale){
        console.log(caveDat)
        
        draw.lineJoin = "round"
        draw.lineCap = "round"
        
        for (i = 0; i < caveDat.length; i++){
            
            
            draw.lineWidth = rand(maxScale,minScale)
            draw.beginPath()
            draw.moveTo(caveDat[i][0],caveDat[i][1])
            for (i2 = 2; i2 < caveDat[i].length; i2+=2){
                
                
                draw.lineTo(caveDat[i][i2],caveDat[i][i2+1])
           
                
            }
            draw.stroke()
            //draw.lineWidth = rand(300,200)
            
        }
       
        
    }

    function genCavesStruct(size,samples,numCaves){
        angle = 0
        dirs = [-1,1]

        caveSegs = []

        px = 0
        py = 0
        
        for (i = 0; i < numCaves; i++){
            dir = dirs[rand(1)]
            angle = 2 * Math.PI / rand(6,1)
            
            px = rand(canvas.width)
            py = rand(canvas.height)
            caveSegs.push([])
            for (i2 = 0; i2 < samples; i2++){
                angleOffset = rand(rad(25),rad(15))
                
                dir = dirs[rand(1)]
                angle += angleOffset* dir

                if (angle < 0){
                    angle *=-1
                }else{
                    if (angle > 2* Math.PI){
                        angle -= 2 * Math.PI
                    }
                }

                len = rand(size,size/angle)
                lineWidth = len

                if (px+len > canvas.width || py+len > canvas.height){
                    break;
                }else{
                    px += Math.cos(angle) * len
                }
                if (px-len < 0 || py-len < 0){
                   break;
                }else{
                    py += Math.sin(angle) * len
                }
                caveSegs[i].push(Math.floor(px),Math.floor(py))
            }
        }
        return caveSegs

    }



    function rad(deg){
        return deg * (Math.PI / 180)
    }
    
 
 
    function sphereCollision2d(x,y,px,py,rad){
        distX = x - px
        distY = y - py
        
        if (Math.floor(distX*distX+distY*distY) < rad*rad){
            console.log(Math.floor(distX*distX+distY*distY))
            return 1
        }
        return 0

    }

    console.log(rand(1,-1))

    function rand(max,min = 0){
        return Math.floor(Math.random()*(max - min+1))+min
    }
    
</script>